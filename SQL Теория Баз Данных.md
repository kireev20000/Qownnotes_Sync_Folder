SQL Теория Баз Данных
========================
## СУБД
СУБД — это система управления базами данных.

Основные функции СУБД: 

1. Создание баз данных, изменение, удаление и объединение их по определённым признакам. 
2. Хранение данных, в том числе больших массивов, в структурированном виде и нужном формате. 
3. Защита данных от взлома и нежелательных изменений при помощи распределённого доступа: когда разным группам пользователей доступны разный объём и сегменты данных. 
4. Выгрузка и сортировка данных по заданным фильтрам при помощи SQL-запросов. 
5. Поддержка целостности баз данных, резервное копирование и восстановление после сбоёв. 





подробнее - [СУБД: что это, виды, структура, функции - где и как используются системы управления базами данных, примеры](https://practicum.yandex.ru/blog/chto-takoe-subd/)

---
## Нереляционные базы данных (NoSQL)
NoSQL — нереляционные СУБД, которые поддерживают другие языки запросов, основанные на языках программирования: например, JavaScript. Такие СУБД встречаются там, где нужно работать с большими данными или архивами документов с огромным количеством разных связей. 

Они отличаются от реляционных тем, что в них для хранения используется не система из строк и столбцов, а применяется модель, которая оптимизирована для хранения определённого типа содержимого. Например, данные могут храниться в виде документов JSON, графов, а также ключей-значений.

Существует несколько типов NoSQL базы данных:
1. Ключ-значение (Redis, Memcached, Amazon DynamoDB). Базу данных этого типа можно представить в виде таблицы, в каждой ячейке которой хранятся значения произвольного типа. Главное преимущество таких баз — поиск по ключу и быстрое получение данных.
Обычно используются для кэшей объектов.
2. Документо-ориентированные (MongoDB, CouchDB, Amazon DocumentDB). Похожи на БД типа ключ-значение, но единица хранения — «документ»; в документ можно записать любой набор данных. Такие базы часто используются для хранения информации о товарах с разнородными характеристиками.
3. Столбцовые (или колоночные) (BigTable, HyperTable, Apache HBase, Apache Cassandra). В таких БД данные хранятся не в строчках, а в столбцах. Это позволяет выполнять быстрый поиск по базе. Область применения — большой объём данных, аналитика.
4. Графовые (neo4j, AllegroGraph, ActiveRDF). Информация в таких БД представлена в виде узлов и отношений между узлами. Графовые БД позволяют эффективно работать с большими объёмами связанных данных; используются, например, для создания соцсетей.

---
## Примеры современных СУБД
### PostgreSQL
Клиент-серверная реляционная СУБД, которая обладает значительной функциональностью и производительностью, при этом доступна бесплатно. Она также подходит для масштабных проектов с большими массивами данных и высокой нагрузкой. 

В качестве основного языка запросов используется SQL, но СУБД также поддерживает его расширения на базе языков программирования: PL/Perl, PL/Python и PL/Java. Одно из главных преимуществ PostgreSQL в том, что здесь нет ограничений по размеру баз данных и числу записей в таблицах. 

### MongoDB
Документная система управления NoSQL, где данные хранятся в виде JSON-файлов (от англ. JavaScript Object Notation), то есть текстовых документов в формате, основанном на JavaScript. Его же СУБД поддерживает в качестве языка запросов вместо SQL. 

Вместо таблиц, как это принято в реляционных СУБД, в MongoDB данные хранятся в виде коллекций, то есть групп документов. Это бесплатная программа для работы с БД с открытым кодом, которая позволяет хранить любые данные, если их перевести в формат JSON. Такие свойства делают её практически универсальной и легко масштабируемой. 

Эта СУБД подходит для работы с большими данными разных типов и из множества разных источников. Данные автоматически распределяются между разными базами так, чтобы оптимизировать нагрузку и ускорить обработку запросов.

### SQLite
SQLite подходит для небольших сайтов и приложений с ограниченным трафиком и объёмом данных, а также сервисов, где нужно прочитать или сохранить файлы на диск. СУБД работает на компьютерах, смартфонах, ТВ, приставках и беспилотниках, не требует администрирования и поддержки. В качестве языка запросов здесь используется С. 

## DBeaver - менеджер баз данных  
Менеджер баз данных DBeaver (Data Explorer) позволяет работать с различными СУБД, такими как MySQL, PostgreSQL, Oracle и другими. Он предоставляет удобный интерфейс для создания, редактирования и выполнения SQL-запросов, а также позволяет просматривать структуру таблиц и данные в них. DBeaver также имеет встроенный редактор кода, позволяющий создавать и редактировать приложения на Java или Python. 

### 

### 
---
## Основные принципы реляционных баз данных:

1. Все данные на концептуальном уровне представляются в виде объектов, заданных в виде строк и столбцов, называемых отношением (таблица);
2. в пересечение строки и столбца таблицы можно занести только одно значение;
3. все операции выполняются над целыми таблицами и результатом этих операций является таблица.

Пример отношения: 

   ![qownnotes-media-eBxXNl](media/qownnotes-media-eBxXNl.png)
                      
На примере таблицы Сотрудник рассмотрим терминологию реляционных баз данных:

1. отношение (таблица)  – это структура данных целиком, набор записей , в  примере –это Сотрудник;
2. кортеж – это каждая строка , содержащая данные (более распространенный термин – запись ), например, <001, Борин С.А, 234-01-23, программист>, все кортежи в отношении должны быть различны;
3. мощность – число кортежей в таблице (проще говоря, число записей), в данном случае 3, мощность отношения может быть любой (от 0 до бесконечности), порядок следования кортежей - неважен;
4. атрибут – это столбец в таблице (более распространенный термин – поле ), в примере – Табельный номер, Фамилия И.О., Телефон, Должность) 
5. размерность – это число атрибутов в таблице, в данном случае – 4;
размерность отношения должна быть больше 0, порядок следования атрибутов существенен;
6. домен атрибута – это допустимые значения (неповторяющиеся), которые можно занести в поле , например для атрибута Должность домен – {инженер, программист}.
ps. академическая теория, скорее сбивает с привычных названий.

---

## Визуализации отношений в БД

Для визуализации отношений в базах данных есть много инструментов, в том числе — бесплатных и доступных онлайн. Например, на сайте quickdatabasediagrams.com. Диаграммы сущность связь.

---

## ER-диаграммы: схема базы данных
При проектировании БД таблицы и их связи изображают схематически; такие схемы называют ER-диаграммы (от англ. Entity-Relationship diagram, «диаграмма сущность — связь»). В схемах описываются таблицы, типы полей и связи с другими таблицами.

![qownnotes-media-KlLVKh](media/qownnotes-media-KlLVKh.png)

![qownnotes-media-dYqEQp](media/qownnotes-media-dYqEQp.png)

Важное свойство первичного ключа — уникальность, но для внешнего ключа это необязательно.

---
###


---
###


---
## Что такое первичный ключ?
Первичный ключ или PRIMARY KEY предназначен для однозначной идентификации каждой записи в таблице и является строго уникальным (UNIQUE): две записи таблицы не могут иметь одинаковые значения первичного ключа. Нулевые значения (NULL) в PRIMARY KEY не допускаются. Если в качестве PRIMARY KEY используется несколько полей, их называют составным ключом.

---
## Когда используется PRIMARY KEY?
PRIMARY KEY — это первичный ключ, который используется в качестве основного ключа и может быть использован для связи с дочерней таблицей, содержащей внешний ключ.
```
CREATE TABLE USERS (
  id INT NOT NULL,
  name VARCHAR (20) NOT NULL,
  PRIMARY KEY (id)
);
```

---
## Что такое внешний ключ?
Внешний ключ или FOREIGN KEY также является атрибутом ограничения и обеспечивает связь двух таблиц. По сути, это поле или несколько полей, которые ссылаются на PRIMARY KEY в родительской таблице

```
CREATE TABLE order (
  order_id INT NOT NULL,
  user_id INT,
  PRIMARY KEY (order_id),
  FOREIGN KEY (user_id) REFERENCES users(id)
);
```
---
## Какие ещё ограничения вы знаете, как они работают и указываются?

1. UNIQUE — гарантирует уникальность значений в столбце;
2. NOT NULL — значение не может быть NULL;
3. INDEX — создаёт индексы в таблице для быстрого поиска/запросов;
4. CHECK — значения столбца должны соответствовать заданным условиям;
5. DEFAULT — предоставляет столбцу значения по умолчанию.

---
## Назовите четыре основных типа соединения в SQL
Чтобы объединить две таблицы в одну, следует использовать оператор JOIN. Соединение таблиц может быть внутренним (INNER) или внешним (OUTER), причём внешнее соединение может быть левым (LEFT), правым (RIGHT) или полным (FULL).

1. INNER JOIN — получение записей с одинаковыми значениями в обеих таблицах, т.е. получение пересечения таблиц.
2. FULL OUTER JOIN — объединяет записи из обеих таблиц (если условие объединения равно true) и дополняет их всеми записями из обеих таблиц, которые не имеют совпадений. Для записей, которые не имеют совпадений из другой таблицы, недостающее поле будет иметь значение NULL.
3. LEFT JOIN — возвращает все записи, удовлетворяющие условию объединения, плюс все оставшиеся записи из внешней (левой) таблицы, которые не удовлетворяют условию объединения.
4. RIGHT JOIN — работает точно так же, как и левое объединение, только в качестве внешней таблицы будет использоваться правая.

![qownnotes-media-bhhXzW](media/qownnotes-media-bhhXzW.png)

Рассмотрим пример соединения SQL таблиц с использованием INNER JOIN. Следующий запрос выбирает все заказы с информацией о клиенте:
```
SELECT Orders.OrderID, Customers.CustomerName
FROM Orders
INNER JOIN Customers ON Orders.CustomerID = Customers.CustomerID;
```
---
## Что такое Self JOIN?
Это выражение используется для того, чтобы таблица объединилась сама с собой, словно это две разные таблицы. Чтобы такое реализовать, одна из таких «таблиц» временно переименовывается.

Например, следующий SQL-запрос объединяет клиентов из одного города:

```
SELECT A.CustomerName AS CustomerName1, B.CustomerName AS CustomerName2, A.City
FROM Customers A, Customers B
WHERE A.CustomerID <> B.CustomerID
AND A.City = B.City
ORDER BY A.City;
```
---
## Для чего нужен оператор UNION?
Он используется для объединения полученных данных из двух или более запросов, которые должны иметь одинаковое количество столбцов с одинаковыми типами данных и расположенных в том же порядке.

Пример использования:
```
SELECT name, city FROM first_table
UNION
SELECT price,  FROM second_table;
```
---
###


---
###


---
###


---
###


---
###


---



---
51 вопрос для собеседования по SQL <https://habr.com/ru/companies/otus/articles/461067/>

---


---

---

---

---

---
Что такое базы данных и для чего они нужны?

---

Какие типы баз данных бывают?

---

Чем РСУБД отличаются от NoSQL БД?

---

Какие достоинства и недостатки есть у РСУБД и NoSQL?

---

Приведите примеры РСУБД и NoSQL БД.

---


Что такое BASE и ACID?

ACID или 4 свойства транзакций

1. Atomicity (атомарность) - транзакция должна быть выполнена целиком или не выполнена вовсе.

2. Consistency (согласованность) - гарантирует, что по мере выполнения транзакций, данные переходят из одного согласованного состояния в другое, то есть транзакция не может разрушить взаимной согласованности данных.

3. Isolation (изолированность) - локализация пользовательских процессов означает, что конкурирующие за доступ к БД транзакции физически обрабатываются последовательно, изолированно друг от друга, но для пользователей это выглядит, как будто они выполняются параллельно.

4. Durability (долговечность) — устойчивость к ошибкам — если транзакция завершена успешно, то те изменения в данных, которые были ею произведены, не могут быть потеряны ни при каких обстоятельствах.

---

Как понять, какую базу данных нужно использовать в проекте?

---

Что такое индексы? Зачем они нужны? Как они работают?

---

Какие популярные виды индексов существуют?

---

Что такое транзакции? Зачем они нужны?

---

Какие виды изолирования транзакций бывают?

---

Что такое профилирование запросов?

---


---

---


---

---


---

---


---

---


---

---


---

---


---
## Уровни изолированности транзакций

Теоретически, все транзакции должны быть изолированы друг от друга. Но в таком случае доступность данных значительно бы понизилась, поскольку операции чтения транзакции блокировали бы операции записи в других транзакциях, и наоборот. Если доступность данных является важным требованием, то это свойство можно ослабить, используя уровни изоляции. 

Уровень изоляции задает степень защищенности выбираемых транзакцией данных от возможности изменения другими транзакциями. 

Выбирая уровень транзакции, мы пытаемся прийти к консенсусу в выборе между высокой согласованностью данных между транзакциями и скоростью выполнения этих самых транзакций.



### Побочные эффекты параллелизма

Все операции в базе происходят не мгновенно и при одновременном изменении данных различными пользователями возможны следующие побочные эффекты:

1. Потерянное обновление (lost update). 
Эффект проявляется при одновременном изменении одного блока данных разными транзакциями. Две транзакции выполняют одновременно UPDATE для одной и той же строки, и изменения, сделанные одной транзакцией, затираются другой

2. «Грязное» чтение (dirty read).
Это такое чтение, при котором могут быть считаны добавленные или изменённые данные из другой транзакции, которая впоследствии не подтвердится (откатится).

3. Неповторяющееся чтение (non-repeatable read).
Проявляется, когда при повторном чтении в рамках одной транзакции, ранее прочитанные данные, оказываются изменёнными.

4. Фантомное чтение (phantom reads).
Можно наблюдать, когда одна транзакция в ходе своего выполнения несколько раз выбирает множество строк по одним и тем же критериям. При этом другая транзакция в интервалах между этими выборками добавляет или удаляет строки, или изменяет столбцы некоторых строк, используемых в критериях выборки первой транзакции, и успешно заканчивается. В результате получится, что одни и те же выборки в первой транзакции дают разные множества строк.

5. аномалия сериализации - Результат успешной фиксации группы транзакций оказывается несогласованным при всевозможных вариантах исполнения этих транзакций по очереди. 
6. 

![qownnotes-media-RPGGXu](media/qownnotes-media-RPGGXu.png)


подробнее - [Уровни изолированности транзакций для самых маленьких / Хабр](https://habr.com/ru/articles/469415/)

еще - [Transact-SQL | Уровни изоляции](https://professorweb.ru/my/sql-server/2012/level3/3_16.php)

еще - [На пути к правильным SQL транзакциям (Часть 1) / Хабр](https://habr.com/ru/companies/infopulse/articles/261097/)

еще - [На пути к правильным SQL транзакциям (Часть 2) / Хабр](https://habr.com/ru/companies/infopulse/articles/261101/)

еще - [Postgres Pro Standard : Документация: 9.5: 13.2. Изоляция транзакций : Компания Postgres Professional](https://postgrespro.ru/docs/postgrespro/9.5/transaction-iso)

---


## Схема Звезда и Схема Снежинка

В Снежинке данные нормализованы связанными таблицами. В Звезде данные почти всегда денормализованы (для ускорения производительности).

---

Знать джойны на уровне "кружочков". Но знать уверено.

Знать, что такое индекс, хотя бы пару их разновидностей. Зачем и когда применяются.

Нормализация и денормализация. Плюсы, минусы, подводные камни.

Порядок выполнения операторов в запросе.

Чем Having отличается от Where.

Суметь составить запрос с соединением пару-тройки таблиц. На чистом SQL и с использованием ORM.

Быть готовым ответить хотя бы на уровне "читал, но забыл" про всякие оконные функции, курсоры, материализованные представления, хранимую логику.

Acid, уровни изоляции, индексы, джоины перекрывают львиную долю вопросов    

Acid, виды изоляции, шардирование верт/гор, индексы, партицирование, виды индексов, репликация.
    
[Что такое ACID? | Самый частый вопрос бэкендеру - YouTube](https://www.youtube.com/watch?v=gOB3hpAVIIQ)   

Разделение бэкенда и базы данных на разные виртуальные машины (VM) может быть полезным в следующих случаях:

1. Масштабирование: Если нагрузка на базу данных или бэкенд значительно увеличивается, вы можете масштабировать каждую часть независимо. Размещение их на разных VM позволит более гибко масштабировать и оптимизировать ресурсы для обработки трафика.

2. Изоляция ресурсов: Разделяя бэкенд и базу данных, вы можете предотвратить конкуренцию за ресурсы. Например, интенсивные вычисления на бэкенде могут оказывать негативное влияние на производительность базы данных, если они работают на одной VM.

3. Безопасность: Размещение базы данных и бэкенда на разных VM может повысить безопасность, уменьшив поверхность атаки. Это может помешать злоумышленникам получить доступ к вашей базе данных, если они успешно проникнут в бэкенд.

4. Управление ресурсами: Если у вас есть разные команды, занимающиеся разработкой и управлением бэкенда и базы данных, разделение на VM позволяет им работать независимо друг от друга, не мешая друг другу.

5. Гибкость технологий: Разные компоненты системы могут требовать разных технологий и настроек. Размещение их на отдельных VM позволяет использовать наиболее подходящие ресурсы и настройки для каждой части.

6. Улучшение обслуживания: Вы можете проводить обслуживание и обновления бэкенда и базы данных независимо друг от друга, минимизируя простои всей системы.

Помните, что выбор разделять бэкенд и базу данных зависит от конкретных требований вашего проекта. В некоторых случаях такое разделение может быть избыточным, поэтому важно анализировать и принимать решение на основе конкретной ситуации.

Понимание джойнов сломано. Это точно не пересечение кругов, честно -  https://habr.com/ru/articles/448072/